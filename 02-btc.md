# btc 密码学原理

首先，讲下比特币系统中用到的密码学原理。

比特币叫做加密货币(crypto-currenty)
但其实呢，加密货币是不加密的，区块链上所以的交易内容都是公开的。包括账户的地址，转账的金额都是公开的。比特币中主要用到了密码学中的两个功能：
一个是哈希，另一个是签名。

大家都比较熟悉hash函数的工作原理。密码学中的用到的函数被称为cryptographics hash function。

他有两个重要的性质，一个叫做collision resistance. 这个地方的collision 是指hash碰撞，如果有两个输入x,y, x != y,但是 H(x) = H(y). 这就叫hash碰撞。两个不同的输入，算出来的hash值是相等的。hash碰撞是很常见的。像我们使用hash表的过程中就会遇到hash碰撞，不同的输入可能被映射到hash表中的同一个位置。一般来说hash碰撞是不可避免的。因为输入空间是远远大于输出的空间的。比如说我们有一个256位的hash值，那输出空间有多大的。所有hash的取值可能行就是2^256. 输出空间就是这么大，但是输入空间可以是无限大的。所以他是有任意多种的输入的可能性。按照鸽笼原理的话，必然会出现，两个输入被映射到同一个输出的情况。所以我们这里说的collision resistance。并不是说不会出现hash碰撞。有的书上管这个性质叫做collision free. 这个说法我不是特别喜欢。因为他容易给人造成误解，好像是碰撞不会发生，实际上碰撞客观存在的，他这个意思的什么呢。是说没有什么高效的方法去人为的构造hash碰撞。给定一个x，没有什么好办法你能找到另外一个y，使得H(x) = H(y). 你硬要找的话，可以用蛮力求解的方法。比如这里的x和y，你就遍历所有的输入的可能性，看看那个算出的来的hash值可能相等。这种叫做brute-force. 遍历输入的所有可能取值，最后找了一个hash最后正好碰撞到了一起。但是如果这个输入空间比较大。比如说是对于一个hash值是256位的话，实际上你要是用这种方法去找的话，在实际中是不可行的，他的工作量实在是太大了。哪莫collision resisten 这个性质有什么用呢？他可以用来对一个message求digest。
比如我们有一个message叫做m。我们取他的hash值，叫做h(m) 这个hash值可以认为是message的digest。用来检测message的篡改。比如说有人改message的内容，他的hash值就会发生变化。那么collisison resistance 这个性质就是说，你找不到另外一个m', 使得h(m')跟原来的hash值相等，所以没有办法篡改内容，而又不被检测出来。比如说你有一个很大的文件，你想把它存在上某个云存储服务上。将来你用到的时候你在下载回来，你怎么知道你下载的版本跟你当初上传的版本 是一样的呢？
这就可以用到这个hash函数的collisison resistance 性质。在你上传这个文件之前。先算一个hash值出来，这个hash值存在本地。将来你下载之后，在算一个hash值，跟原来你存的hash比较一下，如果是一样的话，那么说明的上传的那个文件没有被篡改，下载的还是当初的版本。这就是collisision resstance 的一个用途。
有一点大家注意，没有那个hash函数能够在数学上证明是collsison res, 也就是说我们讲这摸重要的一个性质。从理论上市整不出来的，只能靠实践中的经验。有些hash函数经过长期的实践检验。世界上有那么多的密码学专家。谁也没有能够找到人为制造hash碰撞的方法，所以我们就认为这些hash函数式c r，也有一些hash函数以前我们认为是c r，但是后来，大家找到了hash碰撞的方法，这里面一个很重要的例子就是md5，这个md5 曾经是个很流行的hash函数。大家原来以为他很安全，但是现在不行了。我们已经知道怎么人为的制造hash碰撞了。

